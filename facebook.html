<!DOCTYPE html>
<html lang="en">
<head>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/ngStorage/0.3.10/ngStorage.js"></script>
    <script src="//cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
    <script src="//cdn.firebase.com/libs/angularfire/1.1.3/angularfire.min.js"></script>

    <script>

        var app = angular.module('app', ['ngStorage', 'firebase']);

        app.config(['$localStorageProvider',
            function ($localStorageProvider) {
                $localStorageProvider.setKeyPrefix('');
            }]);

        app.controller('MainController', MainController);

        MainController.$inject = ['$scope', '$timeout', '$localStorage'];

        function MainController($scope, $timeout, $localStorage) {
            var vm = this;
            vm.facebookLogin = facebookLogin;
            vm.deleteFacebookData = deleteFacebookData;
            vm.message = "Result will be displayed here";
            vm.fbData = $localStorage['firebase:session::vivid-fire-7010'];
            console.log('MainController loaded');

            // IMPORTANT: change to match the URL of your Firebase.
            var url = 'https://vivid-fire-7010.firebaseio.com';

            function facebookLogin() {
                var ref = new Firebase(url);
                ref.authWithOAuthPopup('facebook', function (error, authData) {
                    if (error) {
                        console.log('Login Failed', error);
                    } else {
                        console.log('Login Success');
                        $timeout(function() {
                            vm.fbData = authData;
                        });
//                        $scope.$apply();
                    }
                });
            }

            function deleteFacebookData() {
                $localStorage.$reset();
//                $localStorage["firebase:session::vivid-fire-7010"] = null;
//                $timeout(function() {
                    vm.fbData = {};
//                });
            }
        }

    </script>
</head>
<body ng-app="app">

<div ng-controller="MainController as vm">
    <button ng-click="vm.facebookLogin()">Log in with Facebook</button>
    <button ng-click="vm.deleteFacebookData()">Delete data</button>
    <button onclick="location.href='https://www.facebook.com/'">Go to Facebook</button><br />
    <br />
    <div>{{ vm.fbData.facebook.displayName }}</div>
    <div ng-click="vm.showData=!vm.showData">
        <img ng-show="vm.fbData.facebook.profileImageURL" ng-src="{{ vm.fbData.facebook.profileImageURL }}">
    </div>
    <pre ng-show="vm.showData" ng-bind="vm.fbData.facebook | json"></pre>
</div>

</body>
</html>
